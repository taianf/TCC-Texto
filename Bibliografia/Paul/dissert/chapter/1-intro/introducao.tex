\chapter{Introdução}
\label{cap:introducao}

Os sistemas computacionais modernos devem atender a requisitos cada
vez mais diversos e complexos, de acordo com o número crescente dos
seus domínios de aplicação.  Dentre os sistemas computacionais, os
sistemas chamados de \textbf{tempo real} são aqueles especificamente
concebidos para atender às necessidades das aplicações com requisitos
temporais. Além de garantir a correção dos resultados gerados, um
Sistema de Tempo Real (STR) deve também garantir os tempos de execução
das suas tarefas e os prazos de entrega dos resultados.  Portanto, num
sistema de tempo real, as durações e os instantes das ações devem ser
conhecidos de tal forma que o comportamento do sistema seja
determinista e previsível.  Exemplos de tais sistemas encontram-se nos
sistemas mecatrônicos, em embarcados de carros, aeronaves e foguetes.
As plantas industriais e a robótica constituem também domínios de
aplicações destes sistemas.

Distinguem-se duas grandes famílias de STR de acordo com a criticidade
dos requisitos temporais das aplicações: os STR críticos e os STR
não-críticos.  Pode-se entender esta classificação da seguinte
maneira.  Se a perda de um prazo de entrega de um resultado pode ter
alguma conseqüência catastrófica, como a perda de uma vida humana, o
STR é considerado \textbf{crítico}. Por exemplo, se um freio ABS de um
carro ou o trem de pouso de um avião deixar de responder no prazo
previsto, a conseqüência pode ser catastrófica em determinadas
circunstâncias.  Outros sistemas, pelo contrário, podem tolerar a
perda de alguns prazos sem que haja nenhum considerado grave. Por
exemplo, a perda de algumas partes de uma mensagem telefônica pode até
deixar de ser percebida pelos interlocutores. E mesmo se estas perdas
provocam uma alteração perceptível do sinal, elas não têm
conseqüências críticas, e nem sempre impede a compreensão da conversa
pelos interlocutores.  Serviço de tempo real desta natureza, tal como
tele-conferências ou aplicações multimídia, são exemplos de sistemas
com requisitos temporais não-críticos. As falhas temporais do sistema
degradam a qualidade do serviço, mas não comprometem o sistema como um
todo.

No decorrer das últimas três décadas, a pesquisa relativa a sistemas de tempo real
enfrentou vários desafios. Ainda recentemente, considerava-se que estes sistemas
eram compostos apenas de tarefas de tempo real críticas, simples e de duração curta,
típicas das malhas de controle. Hoje, os sistemas de tempo real envolvem novas
aplicações ligadas às áreas de telecomunicação, multimídia, indústria, transporte,
medicina, etc.  Portanto, além das habituais tarefas periódicas críticas que
requerem previsibilidade dos tempos de respostas \cite{Liu73}, os sistemas atuais
tendem a incluir tarefas não-críticas para dar suporte a eventos esporádicos ou
aperiódicos \cite{Liu00}. Tais sistemas, compostos de aplicações com requisitos
temporais variados, críticos e não-críticos, são chamados \textbf{sistemas
  híbridos}.

Outra característica da evolução dos sistemas modernos é a modificação
das suas estruturas, que passaram de arquiteturas centralizadas para
arquitetura distribuídas.  Para dar suporte a tais evoluções, a rede e
os protocolos de comunicação devem ser adaptados para poder lidar com
vários padrões de comunicação e oferecer qualidade de serviço
adequada, tanto para as tarefas com requisitos temporais críticos
quanto para as tarefas não-críticas ou aperiódicas que requerem taxas
de transmissões elevadas. Em conseqüência, as redes industriais
tradicionais tais como Profibus \cite{Profibus96}, ControlNet
\cite{ControlNet97} ou CAN \cite{CAN93, Lian99}, por exemplo,
conhecidas por serem \textbf{deterministas e confiáveis}, podem não
dispor de capacidade de banda suficiente para atender a estas novas
exigências.

% \newpage
Uma alternativa às redes industriais tradicionais é a Ethernet, devido a sua alta
velocidade de transmissão e à disponibilidade de componentes de prateleira de baixo
custo.  Além de ser popular nas arquiteturas de redes a cabo, a tecnologia Ethernet
é bastante adequada para a implementação de protocolos de comunicação um-para-muitos
(\emph{multicast}), conforme ao modelo \emph{publish-subscribe}
\cite{Dolejs04}. Isso tem motivado o uso de Ethernet em ambientes industriais
\cite{Felser05, Decotignie05}.

No entanto, o algoritmo \emph{Binary Exponential Backoff} (BEB), utilizado pelo
protocolo \linebreak CSMA-CD (\emph{Carrier Sense Multiple Access with Collision Detection})
para controlar o acesso ao meio físico das redes Ethernet é probabilístico
\cite{CSMA/CD01,Wang99}, impedindo o uso direto desta tecnologia para aplicações com
requisitos temporais críticos, típicos de contextos industriais.

Durante décadas, várias abordagens foram propostas para garantir o determinismo de
acesso ao meio \cite{Decotignie05}. Algumas envolvem a modificação do protocolo
CSMA/CD no nível do hardware, outras introduzem uma camada de software situada entre
a camada de controle do acesso ao meio e a camada de aplicação.  No capítulo
\ref{cap:motivacao}, apresentaremos de forma mais detalhada as diferentes propostas,
dando um foco maior às soluções baseadas em software. Apesar da diversidade das
abordagens contempladas, mostraremos que algumas propriedades específicas aos
sistemas híbridos, isto é, com requisitos críticos e não-críticos, não conseguem ser
atendidas pelos protocolos existentes de maneira eficiente.

Para oferecer garantias de qualidade de serviço para estes sistemas híbridos e
preservar a modalidade de comunicação um-para-todos (\emph{broadcast}), oferecida
pela tecnologia Ethernet, precisa-se então de um protocolo de comunicação
determinista e confiável que possa otimizar o compartilhamento da banda entre as
tarefas críticas e não-críticas.

No capítulo \ref{cap:doris}, apresentaremos uma proposta de protocolo de comunicação
baseado em software que atende a estes requisitos de sistemas híbridos. Este protocolo
possui importantes características que podem ser assim resumidas:
\begin{itemize}
\item A camada de enlace do protocolo CSMA/CD não é alterada e pode ser desenvolvida
  com interfaces Ethernet comuns, isto é, que respeitam a norma IEEE 802.3
  \cite{CSMA/CD01};
\item As modalidades de comunicação um-para-todos e um-para-muitos, desejáveis para
  sistemas de tempo real, são contempladas sem perdas significativas de desempenho;
\item O algoritmo do protocolo é descentralizado e provê mecanismos de tolerância a
  falhas de comunicação por omissão e a falhas silenciosas de máquinas
  \cite{Schlichting83};
\item Os tempos de transmissão das mensagens são garantidos para as tarefas com
  requisitos temporais críticos;
\item Através de um mecanismo inovador de reserva dinâmica, o protocolo provê uma
  alocação adaptável da banda para a comunicação com requisitos temporais críticos.
\item O compartilhamento da banda entre as comunicações críticas e não-críticas é
  eficiente, isto é, provendo altas taxa de transmissão para aplicações não-críticos
  e garantias temporais para as aplicações críticas.
\end{itemize}

No processo de desenvolvimento, utilizou-se métodos formais para verificar as
funcionalidades do protocolo, à medida que suas definições foram sendo
desenvolvidas. Portanto, escolheu-se apresentar o protocolo e a sua especificação
num mesmo capítulo, pois a especificação formal constitui o melhor instrumento de
descrição do protocolo e das suas propriedades temporais.  A linguagem de
especificação formal escolhida para especificar e verificar o protocolo é a
linguagem de TLA+ (\ing{Temporal Logic of Actions}) \cite{Lamport02a}, junto com o
seu verificador de modelo associado TLC (\ing{Temporal Logic Checker})
\cite{Yu99}. Efetivamente, a estrutura modular desta linguagem permite um processo
de escrita por incrementos sucessivos, de acordo com a elaboração progressiva das
funcionalidades do protocolo. Ademais, o verificador de modelo TLC permite verificar
automaticamente cada um destes incrementos.

Uma vez finalizada a fase de definição do protocolo, primeiro grande desafio deste
trabalho, surgiu a segunda fase, não menos desafiadora, a de implementação.  Para
enfrentar este segundo desafio, buscou-se uma plataforma de tempo real de acesso
livre que fornecesse suporte a aplicações multimídia e de controle via rede
Ethernet. Para esta fase, o sistema Linux \cite{Bovet05} foi escolhido. As
justificativas para tal escolha serão apresentadas no capítulo \ref{cap:platOp}. No
entanto, esta plataforma não oferece as garantias temporais necessárias no contexto
de sistemas de tempo real. Algumas soluções serão então descritas para tornar Linux
determinista.  Entre estas soluções, a plataforma Xenomai \cite{Gerum05}, dotada do
núcleo Adeos \cite{Yaghmour01}, surgiu como uma opção interessante.

Alguns experimentos mostraram a capacidade da plataforma Xenomai-Linux em garantir
piores casos de latência no tratamento de interrupções abaixo de 20 microsegundos em
máquinas atuais. Além disso, Xenomai provê uma camada de comunicação em tempo real,
RTnet \cite{Kiszka05b}, baseada em Ethernet. Esta camada provê um protocolo de
comunicação baseado em TDMA numa topologia de rede centralizada. Decidiu-se
aproveitar desta infra-estrutura de software para dotar a camada RTnet do novo
protocolo aqui proposto.

Finalmente, a descrição desta implementação e de alguns resultados experimentais
serão apresentados no capítulo \ref{cap:implementacao}, e conclusões gerais serão
dadas no capítulo \ref{sec:conclusao}.




% New automation and control systems are characterized by their increasing
% requirements for flexibility and service integration in addition to their usual
% requirements such as fault tolerance and predictability.  Processing in such
% modern real-time distributed systems (RTS) is carried out by hard, soft, periodic
% and aperiodic tasks sharing common resources. Some of these tasks may depend on
% high processing and communication speeds (e.g.  multimedia tasks) while others
% (e.g. control tasks) need to comply with strict timing specifications.

% Lying at the core of new automation and control systems, communication networks
% are of paramount importance as far as Quality-of-Service (QoS) and timing
% correctness are concerned.  Usually, high predictability and fault tolerance are
% achieved by field-bus technologies.  However, such networks are not suitable to
% provide integration and flexibility in hybrid systems. Their low bandwidth, for
% instance, make it difficult to transmit multimedia-like data.
