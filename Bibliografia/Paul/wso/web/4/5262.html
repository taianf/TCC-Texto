<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html class="js" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><title>Linux: Benchmark Comparisons Between Adeos and PREEMPT_RT | KernelTrap</title>



<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="shortcut icon" href="http://kerneltrap.org/sites/default/themes/foundation/favicon.ico" type="image/x-icon">
<style type="text/css" media="all">@import "/files/css/4ff47ee3445e66ca26c3f0370a0d2a62.css";</style>
<script type="text/javascript" src="5262_files/jquery.js"></script>
<script type="text/javascript" src="5262_files/drupal.js"></script>
<script type="text/javascript" src="5262_files/jstools.js"></script>
<script type="text/javascript" src="5262_files/activemenu.js"></script>
<script type="text/javascript">Drupal.extend({ settings: { "jstools": { "cleanurls": true, "basePath": "/" }, "activemenu": { "#block-book-0": "activemenu/book", "#block-menu-1": "activemenu/menu", "#block-menu-62": "activemenu/menu", "#block-menu-166": "activemenu/menu", "#block-user-1": "activemenu/menu" } } });</script>
<script type="text/javascript"> </script></head><body class="body-right">

<div id="logo">
    <a href="http://kerneltrap.org/"><img src="5262_files/newlogo.png" alt="" class="logo" height="134" width="287"></a>
</div>

<div class="header">

  
  <div id="block-block-11" class="block block-block">
    <div class="title">login</div>
  
  <div class="content"><a href="http://kerneltrap.org/user/login">Login</a> / <a href="http://kerneltrap.org/user/register">Register</a></div>
</div>

<div id="block-search-0" class="block block-search">
    <div class="title">Search</div>
  
  <div class="content"><form action="/search/node" method="post" id="search-block-form">
<div><div class="container-inline"><div class="form-item">
 <input maxlength="128" name="search_block_form_keys" id="edit-search-block-form-keys" size="15" value="" title="Enter the terms you wish to search for." class="form-text" type="text">
</div>
<input name="op" id="edit-submit" value="Search" class="form-submit" type="submit">
<input name="form_id" id="edit-search-block-form" value="search_block_form" type="hidden">
</div>
</div></form>
</div>
</div>

<div id="block-ad-165" class="block block-ad">
  
  <div class="content">
<div class="advertisement" id="group-165"><!-- No active ads were found in the tids '165'. --></div>
</div>
</div>

<div id="block-block-12" class="block block-block">
    <div class="title">Header Space</div>
  
  <div class="content"><p>&nbsp;<br>
&nbsp;</p>
</div>
</div>

</div>

<!-- Navigation Lists -->
<div id="navcontainer">
<ul id="navlist">
<li><a href="http://kerneltrap.org/forum" title="Forums">Forums</a></li>
<li><a href="http://kerneltrap.org/news" title="News">News</a></li>
<!--<li><div id="menu-jobs"><a href="/jobs" title="Jobs">Jobs</a></div></li>-->
<li><a href="http://kerneltrap.org/blogs" title="Blogs">Blogs</a></li>
<li><a href="http://kerneltrap.org/features" title="Features">Features</a></li>
<li><a href="http://kerneltrap.org/man" title="Man Pages">Man Pages</a></li>
<li><a href="http://kerneltrap.org/site" title="Site">Site</a></li>
</ul>
</div>


<div class="container">
  
  <div class="page">
    <div class="wrapper">
        <div class="breadcrumb"><div class="breadcrumb"><a href="http://kerneltrap.org/">Home</a></div></div>
    
    
    
    
        <h2 class="title">Linux:  Benchmark Comparisons Between Adeos and PREEMPT_RT</h2>
    
    
    
    <div id="node-5262" class="node node-story">
  
  
    <div class="date">June 12, 2005 - 10:58pm</div>
  <!-- <div class="author">Submitted by <a href="/user/1" title="View user profile.">Jeremy</a></div> -->
  <div class="author">Submitted by <a href="http://kerneltrap.org/user/1" title="View user profile.">Jeremy</a> on June 12, 2005 - 10:58pm.</div>
  
  <div class="taxonomy_image">
    <img src="5262_files/K-Linux_0.gif" alt="Linux news" height="75" width="75">  </div>

  <div class="content">
  <p>Kristian Benoit posted some <a href="http://kerneltrap.org/mailarchive/1/message/78173/thread">benchmark comparisons</a> beetween Adeos, the <a href="http://home.gna.org/adeos/" target="new">Adaptive Domain Environment for Operating Systems</a> [<a href="http://kerneltrap.org/node/237">story</a>], and Ingo Molnar [<a href="http://kerneltrap.org/node/517">interview</a>]'s voluntary kernel preemption patch [<a href="http://kerneltrap.org/node/3440">story</a>], enabled via the PREEMPT_RT kernel configration option.  Kristian explained. "<i>this comparison was done in order to better understand the impact of each method vis-a-vis vanilla Linux.</i>"  He went on to add, "<i>the
above data has been provided as-is without any analysis for now. We
will provide such analysis when publishing the complete data sets and
related software. In the mean time, we hope such results will help
further reflection.</i>"</p>
<p>The resulting discussion determined that the tests hadn't used
optimal configurations, most noticeably with PREEMPT_RT in which
numerous debugging options were enabled adding overhead. Ingo explained
the effect of various configuration options, going on to note that his
kernel preemption patch recently underwent a round of performance
improvements that were not included in the tests. Other benchmarking
tools were also discussed to provide a more complete comparison between
the two methods. The feedback was acknowledged with additional
benchmarking and analysis planned for the upcoming week, taking the
various suggestions into account. Karim Yaghmour replied to the many
suggestions for additional tests, "<i>we'll try to take as many of
these as possible. This is relatively simple given the scripts Kristian
has put together. Nevertheless, it must be understood that we don't
have infinite resources. So in sharing the framework we've developed,
we hope others will be motivated to conduct their own tests.</i>"</p><div class="autolinks">Submit to: <a href="http://reddit.com/submit?url=http://kerneltrap.org/node/5262&amp;title=Linux:%20%20Benchmark%20Comparisons%20Between%20Adeos%20and%20PREEMPT_RT">Reddit</a>, <a href="http://digg.com/submit?phase=2&amp;url=http://kerneltrap.org/node/5262&amp;title=Linux:%20%20Benchmark%20Comparisons%20Between%20Adeos%20and%20PREEMPT_RT">Digg</a>, <a href="http://slashdot.org/submit.pl?url=http://kerneltrap.org/node/5262&amp;title=Linux:%20%20Benchmark%20Comparisons%20Between%20Adeos%20and%20PREEMPT_RT">Slashdot</a>, <a href="http://del.icio.us/post?url=http://kerneltrap.org/node/5262&amp;title=Linux:%20%20Benchmark%20Comparisons%20Between%20Adeos%20and%20PREEMPT_RT">Del.icio.us</a>, <a href="http://osnews.com/submit.php?url=http://kerneltrap.org/node/5262&amp;title=Linux:%20%20Benchmark%20Comparisons%20Between%20Adeos%20and%20PREEMPT_RT">OSNews</a></div>
<p></p><hr>
<pre><b>From: Kristian Benoit</b> [email blocked]
To:  linux-kernel
Subject: PREEMPT_RT vs ADEOS: the numbers, part 1
Date:	Sat, 11 Jun 2005 00:36:59 -0400

For the past few weeks, we've been conducting comparison tests between
PREEMPT_RT and the Adeos nanokernel. As was clear from previous discussion,
we've been open to be proven wrong regarding endorsement of either method.
Hence, this comparison was done in order to better understand the impact
of each method vis-a-vis vanilla Linux.

At this time, we are publishing the summary results of the various test
runs we've conducted. There is, of course, a lot of background information
that needs to be provided (.configs, scripts, drivers, etc.) We will be
making those available sometime early next week. In the mean time, the
following is meant as food-for-thought.

In our tests, we've used a set up with 3 machines. The two main systems
were Dell PowerEdge SC420 machines with a P4 2.8 (UP not SMP configured) with
FC3. One had 256 MB RAM and was the guinea pig (i.e. the machine controlling
the mechanical saw a.k.a. TARGET) The other, having 512 MB RAM, was used to
collect data regarding the guinea pig's responsiveness (a.k.a LOGGER.) The
third machine, an Apple PowerBook 5,6 G4 / 1GB, was used for a dual purpose.
First, it controlled both the target and the logger via ssh, and was also
used to ping flood the target. This 3rd system is known as the HOST.

Data was generated on all three systems:
TARGET: LMbench data
LOGGER: Interrupt response time
HOST: LMbench total running time

Both the host and the logger had a constant kernel configuration. The logger
was running an adeos-enabled kernel in order to trigger and deterministically
measure the responsiveness of the target. The host was running a plain
gentoo-based kernel. The target and the logger were rigged via their parallel
ports so that an output from the logger would trigger an interrupt on the
target who's response would itself trigger an interrupt on the logger.

In the various test runs, we've attempted to collect two sets of data. One
regarding LMbench's total running time for a given set up and the other
regarding the system's interrupt response time. Where appropriate, both tests
were conducted simultaneously. Otherwise, they were conducted in isolation.
The following tables should be self-explanatory.

For LMbench test runs, 3 passes were conducted and an average running time
was collected. Certainly, 3 passes is not as much as we'd like, but for the
immediate purposes, it provides a sufficiently corroborated data set for
analysis (as can be seen in the following tables.)

For the interrupt response time measurement, the logger generated between
500,000 to 650,000 interrupts and measured the target's response time. The
logger was not subject to any load whatsoever, except that imposed by the
logging driver (running in a prioritary Adeos domain, and hence being truly
hard-rt, a.k.a. "ruby" hard) and that of the user-space daemon committing the
data to storage. It could be argued that the use of Adeos imposes a penalty
to the measured response time. However, this penalty is imposed on all data
sets, and verification of its impact can be inferred by analyzing the adeos-to-
adeos set up provided below.

With no further ado, here are the results we've obtained. As we said above, we
will be making all related scripts, patches, and drivers available, so that
others may conduct their own tests.

Note that in the tests we've conducted, we've tried, in as much possible, to
use similar kernels. However, we were unable to find a recent Adeos and a
recent PREEMPT_RT patch which would both cleanly apply to a same recent kernel.
Hence, we've compared vanilla 2.6.12-rc2 with an adeos-patched one and a
2.6.12-rc4 with a PREEMPT_RT-patched one. As can be seen below, the runs of
the vanilla rc2 and rc4 yield very similar numbers, and can therefore
reasonably be considered equivalent.

LMbench running times:
+--------------------+--------+----------+------------+------------+----------+
| Kernel             | plain  | IRQ test | ping flood | IRQ &amp; ping | IRQ &amp; hd |
+====================+========+==========+============+============+==========+
| Vanilla-2.6.12-rc2 | 174  s | 175    s | 189      s | 193      s | 217    s |
+--------------------+--------+----------+------------+------------+----------+
| with Adeos-r10c3   | 180  s | 180    s | 185      s | 183      s | 211    s |
+--------------------+--------+----------+------------+------------+----------+
| %                  | +3.4   | +2.9     | -2.1       | -5.2       | -2.8     |
+====================+========+==========+============+============+==========+
| Vanilla-2.6.12-rc4 | 176  s | 177    s | 189      s | 191      s | 218    s |
+--------------------+--------+----------+------------+------------+----------+
| with RT-V0.7.47-08 | 184  s | 187    s | 206      s | 201      s | 225    s |
+--------------------+--------+----------+------------+------------+----------+
| %                  | +4.5   | +5.6     | +9.0       | +5.2       | +3.2     |
+--------------------+--------+----------+------------+------------+----------+

Legend:
plain          = Nothing special
IRQ test       = on logger: triggering target every 1ms
ping flood     = on host: "sudo ping -f $TARGET_IP_ADDR"
IRQ &amp; ping     = combination of the previous two
IRQ &amp; hd       = IRQ test with the following being done on the target:
                 "while [ true ]
                     do dd if=/dev/zero of=/tmp/dummy count=512
                  done"

In the following, interrupts are triggered by the logger at every 1ms. It would
be interesting to redo such tests with shorter trigger times. However, we
wanted to keep the logger as "off-the-shelf" as possible.

Interrupt response times (all in micro-seconds):
+--------------------+------------+------+-------+------+--------+
| Kernel             | sys load   | Aver | Max   | Min  | StdDev |
+====================+============+======+=======+======+========+
|                    | None       | 15.5 |  64.8 | 15.2 | 1.0    |
|                    | Ping       | 15.7 |  63.4 | 15.2 | 1.2    |
| Vanilla-2.6.12-rc2 | lm. + ping | 16.0 |  72.2 | 15.2 | 1.4    |
|                    | lmbench    | 15.8 |  65.6 | 15.2 | 1.1    |
|                    | lm. + hd   | 15.8 | 179.9 | 15.2 | 1.3    |
+--------------------+------------+------+-------+------+--------+
|                    | None       | 13.4 |  53.3 | 13.2 | 0.2    |
|                    | Ping       | 13.8 |  53.3 | 13.3 | 0.6    |
| with Adeos-r10c3   | lm.+ ping  | 13.9 |  21.8 | 13.2 | 0.7    |
|                    | lmbench    | 13.9 |  21.3 | 13.3 | 0.6    |
|                    | lm. + hd   | 13.9 |  53.2 | 13.2 | 0.5    |
+====================+============+======+=======+======+========+
|                    | None       | 15.2 |  64.2 | 15.2 | 0.5    |
|                    | Ping       | 15.6 |  63.0 | 15.2 | 0.9    |
| Vanilla-2.6.12-rc4 | lm. + ping | 16.0 | 170.5 | 16.0 | 1.4    |
|                    | lmbench    | 15.8 | 184.1 | 15.2 | 1.2    |
|                    | lm. + hd   | 15.8 |  67.1 | 15.0 | 1.1    |
+--------------------+------------+------+-------+------+--------+
|                    | None       | 15.5 | 73.8  | 15.2 | 1.2    |
|                    | Ping       | 17.1 | 79.8  | 15.2 | 2.3    |
| with RT-V0.7.47-08 | lm. + ping | 17.7 | 77.2  | 15.2 | 3.1    |
|                    | lmbench    | 17.1 | 80.0  | 15.3 | 2.3    |
|                    | lm. + hd   | 17.0 | 80.0  | 15.3 | 1.8    |
+--------------------+------------+------+-------+------+--------+

Legend:
None           = nothing special
ping           = on host: "sudo ping -f $TARGET_IP_ADDR"
lm. + ping     = previous test and "make rerun" in lmbench-2.0.4/src/ on target
lmbench        = "make rerun" in lmbench-2.0.4/src/ on target
lm. + hd       = previous test  with the following being done on the target:
                 "while [ true ]
                     do dd if=/dev/zero of=/tmp/dummy count=512
                  done"

Note: Adeos-r10c3 is a "combo" patch including both Adeos and PREEMPT_RT, though
PREEMPT_RT is disabled.

The above data has been provided as-is without any analysis for now. We will
provide such analysis when publishing the complete data sets and related
software. In the mean time, we hope such results will help further reflection.

Best regards and have fun !!!

Kristian Benoit
Karim Yaghmour
-- 
Pushing Embedded and Real-Time Linux Systems Beyond the Limits
<a href="http://www.opersys.com/" target="new">http://www.opersys.com</a> || 1-866-677-4546

<br>
<b>From: <a href="http://kerneltrap.org/node/view/657">Nick Piggin</a></b> [email blocked]
Subject: Re: PREEMPT_RT vs ADEOS: the numbers, part 1
Date:	Sat, 11 Jun 2005 16:14:05 +1000

Kristian Benoit wrote:
&gt; For the past few weeks, we've been conducting comparison tests between
&gt; PREEMPT_RT and the Adeos nanokernel. As was clear from previous discussion,
&gt; we've been open to be proven wrong regarding endorsement of either method.
&gt; Hence, this comparison was done in order to better understand the impact
&gt; of each method vis-a-vis vanilla Linux.
&gt; 

This is wonderful data, thanks very much for putting in the work.
I hope this thread and future threads on this topic can be steered
more towards technical facts and numbers, as that is the only way
to make sane choices.

Nick

-- 
SUSE Labs, Novell Inc.

<hr>
<b>From: <a href="http://kerneltrap.org/node/view/517">Ingo Molnar</a></b> [email blocked]
Subject: Re: PREEMPT_RT vs ADEOS: the numbers, part 1
Date:	Sat, 11 Jun 2005 09:08:45 +0200


could you send me the .config you used for the PREEMPT_RT tests? Also, 
you used -47-08, which was well prior the current round of performance 
improvements, so you might want to re-run with something like -48-06 or 
better.

	Ingo

<br>
<b>From: <a href="http://kerneltrap.org/node/view/517">Ingo Molnar</a></b> [email blocked]
Subject: Re: PREEMPT_RT vs ADEOS: the numbers, part 1
Date:	Sat, 11 Jun 2005 12:37:07 +0200


* Ingo Molnar [email blocked] wrote:

&gt; could you send me the .config you used for the PREEMPT_RT tests? Also, 
&gt; you used -47-08, which was well prior the current round of performance 
&gt; improvements, so you might want to re-run with something like -48-06 
&gt; or better.

make that -48-10 or better.

	Ingo



<br>
<b>From: <a href="http://kerneltrap.org/node/view/657">Nick Piggin</a></b> [email blocked]
Subject: Re: PREEMPT_RT vs ADEOS: the numbers, part 1
Date:	Sat, 11 Jun 2005 17:44:17 +1000

Ingo Molnar wrote:
&gt; could you send me the .config you used for the PREEMPT_RT tests? Also, 
&gt; you used -47-08, which was well prior the current round of performance 
&gt; improvements, so you might want to re-run with something like -48-06 or 
&gt; better.
&gt; 

The other thing that would be really interesting is to test latencies
of various other kernel functionalities in the RT kernel (eg. message
passing, maybe pipe or localhost read/write, signals, fork/clone/exit,
mmap/munmap, faulting in shared memory, or whatever else is important
to the RT crowd).

-- 
SUSE Labs, Novell Inc.

<hr>

<b>From: Karim Yaghmour</b> [email blocked]
Subject: Re: PREEMPT_RT vs ADEOS: the numbers, part 1
Date:	Sat, 11 Jun 2005 10:31:42 -0400


Ingo Molnar wrote:
&gt; could you send me the .config you used for the PREEMPT_RT tests? Also, 
&gt; you used -47-08, which was well prior the current round of performance 
&gt; improvements, so you might want to re-run with something like -48-06 or 
&gt; better.

Much to our dislike, we only noticed that we forgot to disable the debug
options after posting the results :/ So, in all fairness, we will be
redoing the tests on PREEMPT_RT early next week. In the plethora of things
we wanted to try, it also seems that the "dd" test wasn't exactly as it
was supposed to be. There should've been a "bs=1M" in there; as it
currently is, the dd command doesn't really put any real load. We'll add
this one to our repeats.

I notice there are already suggestions regarding additional types of
tests, and that's good. We'll try to take as many of these as possible.
This is relatively simple given the scripts Kristian has put together.
Nevertheless, it must be understood that we don't have infinite resources.
So in sharing the framework we've developed, we hope others will be
motivated to conduct their own tests.

Karim
-- 
Author, Speaker, Developer, Consultant
Pushing Embedded and Real-Time Linux Systems Beyond the Limits
<a href="http://www.opersys.com/" target="new">http://www.opersys.com</a> || [email blocked] || 1-866-677-4546

<br>
<b>From: <a href="http://kerneltrap.org/node/view/517">Ingo Molnar</a></b> [email blocked]
Subject: Re: PREEMPT_RT vs ADEOS: the numbers, part 1
Date:	Sat, 11 Jun 2005 16:52:40 +0200


* Karim Yaghmour [email blocked] wrote:

&gt; Ingo Molnar wrote:
&gt; &gt; could you send me the .config you used for the PREEMPT_RT tests? Also, 
&gt; &gt; you used -47-08, which was well prior the current round of performance 
&gt; &gt; improvements, so you might want to re-run with something like -48-06 or 
&gt; &gt; better.
&gt; 
&gt; Much to our dislike, we only noticed that we forgot to disable the 
&gt; debug options after posting the results :/ So, in all fairness, we 
&gt; will be redoing the tests on PREEMPT_RT early next week. [...]

yeah, i suspected something like that - the PREEMPT_RT latency numbers 
were so out of whack with anything i've measured on similar boxes. The 
debugging features on PREEMPT_RT are powerful but have a high overhead.

could you send me your PREEMPT_RT .config? (whichever version you have 
handy) That's the easiest way i can tell you which options to watch out 
for.

	Ingo

<br>
<b>From: <a href="http://kerneltrap.org/node/view/517">Ingo Molnar</a></b> [email blocked]
Subject: Re: PREEMPT_RT vs ADEOS: the numbers, part 1
Date:	Sat, 11 Jun 2005 20:15:28 +0200


* Karim Yaghmour [email blocked] wrote:

&gt; Here's the .config for 2.6.12-rc4-RT-V0.7.47-08:

Thanks. These PREEMPT_RT debugging features should be disabled:

&gt; CONFIG_DEBUG_PREEMPT=y
&gt; CONFIG_WAKEUP_TIMING=y
&gt; CONFIG_PREEMPT_TRACE=y
&gt; CONFIG_LATENCY_TIMING=y
&gt; CONFIG_RT_DEADLOCK_DETECT=y

they all cause significant overhead.

I'd also disable these two security options:

&gt; CONFIG_AUDIT=y
&gt; CONFIG_SECURITY=y

unless you are running an selinux-enabled environment.

i've had not that good experiences with HPET:

&gt; CONFIG_HPET_TIMER=y
&gt; CONFIG_HPET_EMULATE_RTC=y

so i'd disable it - but YMMV.

i'd also disable PAE and use CONFIG_NOHIGHMEM:

&gt; CONFIG_HIGHMEM64G=y

unless you have more than 4GB of RAM. (if you have between 1GB and 4GB 
then use HIGHMEM4G)

then i'd disable stack-overflow checking as well:

&gt; CONFIG_DEBUG_STACKOVERFLOW=y
&gt; CONFIG_DEBUG_STACK_USAGE=y

since you are not running 4K stacks.

	Ingo

<br>
<b>From: James R Bruce</b> [email blocked]
Subject: Re: PREEMPT_RT vs ADEOS: the numbers, part 1
Date:	Sun, 12 Jun 2005 06:47:01 -0400 (EDT)

Ingo, if you could document the right options required for decent performace
somewhere it would be quite helpful (maybe in Documentation/rt-preempt?).  My 
first test of Preempt-RT showed unexpectedly high overhead for a fairly benign 
network load (120 UDP packets/sec), but that was likely the result of leaving 
some debugging options on.

I'll try to run an updated test in the near future and see if there are still 
issues.  In the meantime I'll be saving your email to make sure I get the 
config options right.

 - Jim

<br>
<b>From: <a href="http://kerneltrap.org/node/view/517">Ingo Molnar</a></b> [email blocked]
Subject: Re: PREEMPT_RT vs ADEOS: the numbers, part 1
Date:	Sun, 12 Jun 2005 16:54:01 +0200


* James R Bruce [email blocked] wrote:

&gt; Ingo, if you could document the right options required for decent 
&gt; performace somewhere it would be quite helpful (maybe in 
&gt; Documentation/rt-preempt?).  My first test of Preempt-RT showed 
&gt; unexpectedly high overhead for a fairly benign network load (120 UDP 
&gt; packets/sec), but that was likely the result of leaving some debugging 
&gt; options on.

agreed, this needs to be addressed.

in the latest patch (-48-17 or later) i have changed the debugging 
options to default to off. (this wont turn them off if your .config has 
them turned on already, but will turn them off for new testers' 
.configs)

I also added a prominent boot-time message that, if certain 
high-overhead debugging options are enabled, says:

*****************************************************************************
*                                                                           *
* WARNING, the following debugging options are turned on in your .config:   *
*                                                                           *
*        CONFIG_DEBUG_RT_LOCKING_MODE                                       *
*        CONFIG_RT_DEADLOCK_DETECT                                          *
*        CONFIG_DEBUG_PREEMPT                                               *
*        CONFIG_CRITICAL_PREEMPT_TIMING                                     *
*        CONFIG_CRITICAL_IRQSOFF_TIMING                                     *
*        CONFIG_LATENCY_TRACE                                               *
*        CONFIG_DEBUG_SLAB                                                  *
*                                                                           *
* they may increase runtime overhead and latencies considerably!            *
*                                                                           *
*****************************************************************************

wrt. documentation - i'm not a big doc writer, but i'm taking patches
:-)

	Ingo

<hr>
<b>From: <a href="http://kerneltrap.org/node/view/517">Ingo Molnar</a></b> [email blocked]
Subject: Re: PREEMPT_RT vs ADEOS: the numbers, part 1
Date:	Sat, 11 Jun 2005 21:27:22 +0200


a couple of other wrokloads that are easy to measure and are useful for 
triggering worst-case latencies:

hackbench:

  <a href="http://developer.osdl.org/craiger/hackbench/" target="new">http://developer.osdl.org/craiger/hackbench/</a>
  <a href="http://developer.osdl.org/craiger/hackbench/src/hackbench.c" target="new">http://developer.osdl.org/craiger/hackbench/src/hackbench.c</a>

it creates tons of threads and does message-passing between them. E.g.  
"hackbench 50" or "hackbench 100" is a pretty good test.

i use 40 copies of LTP running in parallel:

   while true; do ./runalltests.sh -x 40; done

this is good at triggering worst-case latencies too. Plus dbench is good 
too:

  <a href="http://samba.org/ftp/tridge/dbench/" target="new">http://samba.org/ftp/tridge/dbench/</a>
  <a href="http://samba.org/ftp/tridge/dbench/dbench-3.03.tar.gz" target="new">http://samba.org/ftp/tridge/dbench/dbench-3.03.tar.gz</a>

  # dbench-3.03&gt; ./dbench 50 -c ./client.txt

also, there's a very good on-host IRQ-latency measurement tool as well:

   <a href="http://www.affenbande.org/%7Etapas/wiki/index.php?rtc_wakeup" target="new">http://www.affenbande.org/~tapas/wiki/index.php?rtc_wakeup</a>

this uses TSC timestamping to detect wall-clock delays of the RTC 
interrupt. The tools jumps through lots of hoops to make sure the 
numbers are reliable. If you run it under the -RT kernel then run the 
RTC IRQ thread at a higher-than-all-other-threads priority:

  chrt -f 95 -p `pidof 'IRQ 8'`
  ./rtc_wakeup -f 1024 -t 100000

(when you run it, and if you also have RTC_HISTOGRAM enabled in your 
.config, then the kernel will print a histogram when you stop 
rtc_wakeup, so you've got two sources of information.)

	Ingo

<br>
<b>From: Karim Yaghmour</b> [email blocked]
Subject: Re: PREEMPT_RT vs ADEOS: the numbers, part 1
Date:	Sun, 12 Jun 2005 00:21:13 -0400


Ingo Molnar wrote:
&gt; hackbench:
&gt; 
&gt;   <a href="http://developer.osdl.org/craiger/hackbench/" target="new">http://developer.osdl.org/craiger/hackbench/</a>
&gt;   <a href="http://developer.osdl.org/craiger/hackbench/src/hackbench.c" target="new">http://developer.osdl.org/craiger/hackbench/src/hackbench.c</a>
[snip]
&gt; this is good at triggering worst-case latencies too. Plus dbench is good 
&gt; too:
&gt; 
&gt;   <a href="http://samba.org/ftp/tridge/dbench/" target="new">http://samba.org/ftp/tridge/dbench/</a>
&gt;   <a href="http://samba.org/ftp/tridge/dbench/dbench-3.03.tar.gz" target="new">http://samba.org/ftp/tridge/dbench/dbench-3.03.tar.gz</a>

hackbench and dbench are fine by me, they seem good tests to run.

However ...

&gt; also, there's a very good on-host IRQ-latency measurement tool as well:
&gt; 
&gt;    <a href="http://www.affenbande.org/%7Etapas/wiki/index.php?rtc_wakeup" target="new">http://www.affenbande.org/~tapas/wiki/index.php?rtc_wakeup</a>

This tool I just can't trust. Any software tool that measures the
interrupt latency of the system on which it runs is highly suspect.
There are far too many things happening on the system itself for
the tool to act as an "independent" observer. The only true way to
measure interrupt latency is to have some outside system generate
the interrupts and measure the target system's response time.

In our early tests, we actually had an oscilloscope hooked onto
the target and we had a function generator ready to go for pumping
square waves into the target. However, after spending quite some
time looking at the output on the scope, we concluded that there
was just no way for us to measure the peaks (at least with the
scope we had access to; there are very fancy scopes out there
that can probably do a better job by collecting entire samples,
but we don't have those at hand and so too will it be very likely
that others who want to make such measurements may not have
access to such scopes.) Hence the use of the logger to trigger
and measure interrupts. The logger, target and host setup we
put together can very well be implemented using even antiquated
PCs, something any computer enthusiast can easily obtain very
cheaply at any used computer parts store in their neighborhood.

&lt;background&gt;
A truly hard-rt deterministic system should be very easily
viewed using a function generator and a scope. You pump the
square wave, and the measured system generates a delayed
wave. The interrupt latency is the distance between the two.
You would then be able to increase the square wave's frequency
and see the target system follow, up until it couldn't respond
no more and then by turning the knob down back again, you would
find the nice response square waves again. On modern PCs, even
the hardware isn't deterministic, so you can't see such nice
waves. Instead, you need to collect samples and determine
maximums.
&lt;/background&gt;

So hackbench and dbench yes, but rtc_wakeup ... hmm ...

Karim
-- 
Author, Speaker, Developer, Consultant
Pushing Embedded and Real-Time Linux Systems Beyond the Limits
<a href="http://www.opersys.com/" target="new">http://www.opersys.com</a> || [email blocked] || 1-866-677-4546
</pre><p>
</p><hr><br>
<b>Related Links:</b>
<ul>
<li><a href="http://kerneltrap.org/mailarchive/1/message/78173/thread">Archive of above thread</a>
</li><li><a href="http://kerneltrap.org/node/view/657">KernelTrap interview with Nick Piggin</a>
</li><li><a href="http://kerneltrap.org/node/view/517">KernelTrap interview with Ingo Molnar</a>
</li></ul>
    </div>

  <div class="links"><ul class="links inline"><li class="first comment_add"><a href="http://kerneltrap.org/comment/reply/5262#comment-form" title="Share your thoughts and opinions related to this posting." class="comment_add">Add new comment</a></li>
<li class="last print"><a href="http://kerneltrap.org/node/5262/print" title="Display a printer friendly version of this page." class="print">Printer friendly version</a></li>
</ul></div>
</div>

<div id="comments"><a id="comment-130123"></a>
<div id="comment-130123" class="comment">
    <h4 class="title">
    <a href="http://kerneltrap.org/node/5262#comment-130123" class="active">Typo?</a>      </h4>
  
  
    <div class="date">June 14, 2005 - 3:37am</div>
  <div class="author">Anonymous Coward (not verified)</div>
  
  <div class="content"><p>I think "Ingo explained the <b>affect</b> of various configuration options" sould be "Ingo explained the <b>effect</b> of various configuration options".</p>
</div>

  <div class="links"><ul class="links"><li class="first last comment_reply"><a href="http://kerneltrap.org/comment/reply/5262/130123" class="comment_reply">reply</a></li>
</ul></div>
</div>

<div class="indented"><a id="comment-130124"></a>
<div id="comment-130124" class="comment">
    <h4 class="title">
    <a href="http://kerneltrap.org/node/5262#comment-130124" class="active">Meta-typo!</a>      </h4>
  
  
    <div class="date">June 14, 2005 - 4:09am</div>
  <div class="author">Anonymous</div>
  
  <div class="content"><p>s/sould/should/</p>
</div>

  <div class="links"><ul class="links"><li class="first last comment_reply"><a href="http://kerneltrap.org/comment/reply/5262/130124" class="comment_reply">reply</a></li>
</ul></div>
</div>

</div><form action="/node/5262" method="post" id="comment-controls">
<div><div class="box">
    <h3 class="title">Comment viewing options</h3>
  
  <div class="content"><div class="container-inline"><input name="form_id" id="edit-comment-controls" value="comment_controls" type="hidden">
<div class="form-item">
 <select name="mode" class="form-select" id="edit-mode"><option value="1">Flat list - collapsed</option><option value="2">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4" selected="selected">Threaded list - expanded</option></select>
</div>
<div class="form-item">
 <select name="order" class="form-select" id="edit-order"><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page"><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50" selected="selected">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300">300 comments per page</option></select>
</div>
<input name="op" id="edit-submit" value="Save settings" class="form-submit" type="submit">
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
</div>

</div></form>
</div>    </div>
  </div>

    <div class="sidebar sidebar-right"><div id="block-user-1" class="block block-user">
    <div class="title">Navigation</div>
  
  <div class="content">
<ul class="menu">
<li class="collapsed activemenu-processed"><a href="http://kerneltrap.org/node/add">Create content</a></li>
<li class="leaf"><a href="http://kerneltrap.org/mailarchive">Mailing list archives</a></li>
<li class="leaf"><a href="http://kerneltrap.org/tracker">Recent posts</a></li>

</ul>
</div>
</div>

<div id="block-block-14" class="block block-block">
  
  <div class="content"><p><!--Ad Bard Image, 175 pixels wide by 125 pixels high --></p>
<script type="text/javascript" src="5262_files/serve.js"></script><div class="image-advertisement" id="ad-41"><a href="http://adbard.net/ad/redirect/41/e73d04e72743899cf8dc6b81c15e825c" title="Join the Ad Bard Network" target="_blank"><img src="5262_files/FOSSfastfree.png" height="125" width="175"></a></div><a href="http://adbard.net/ad/redirect/9/e73d04e72743899cf8dc6b81c15e825c">Ads by Ad Bard</a><p><!--end--></p>
</div>
</div>

<div id="block-forum_addons-0" class="block block-forum_addons">
    <div class="title">Latest forum posts</div>
  
  <div class="content"><table>
 <thead><tr><th></th><th></th><th></th> </tr></thead>
<tbody>
 <tr class="odd"><td><a href="http://kerneltrap.org/node/15809">Performance issues with 2 dual-core Xeon processors</a></td><td>3 hours ago</td><td><a href="http://kerneltrap.org/forum/linux/kernel">Linux kernel</a></td> </tr>
 <tr class="even"><td><a href="http://kerneltrap.org/node/14995">how to create initrd image for custom kernel</a></td><td>7 hours ago</td><td><a href="http://kerneltrap.org/forum/linux/kernel">Linux kernel</a></td> </tr>
 <tr class="odd"><td><a href="http://kerneltrap.org/node/15811">Cisco is looking for 2-3 Open Source Software engineers with (BSD/GPL/LGPL license)</a></td><td>7 hours ago</td><td><a href="http://kerneltrap.org/forum/bsd/openbsd">OpenBSD</a></td> </tr>
 <tr class="even"><td><a href="http://kerneltrap.org/node/15810">Cisco is looking for 2-3 Open source Software Engineer with GPL/BSD/LGPL license experience</a></td><td>7 hours ago</td><td><a href="http://kerneltrap.org/forum/linux/kernel">Linux kernel</a></td> </tr>
 <tr class="odd"><td><a href="http://kerneltrap.org/node/6918">Resetting the bios password for Toshiba Laptop</a></td><td>14 hours ago</td><td><a href="http://kerneltrap.org/forum/other/hardware">Hardware</a></td> </tr>
 <tr class="even"><td><a href="http://kerneltrap.org/node/5772">windows folder creation surprise</a></td><td>16 hours ago</td><td><a href="http://kerneltrap.org/forum/other/windows">Windows</a></td> </tr>
 <tr class="odd"><td><a href="http://kerneltrap.org/node/15805">lkml down?</a></td><td>19 hours ago</td><td><a href="http://kerneltrap.org/forum/linux/kernel">Linux kernel</a></td> </tr>
 <tr class="even"><td><a href="http://kerneltrap.org/node/15802">problems with ftp server crash</a></td><td>23 hours ago</td><td><a href="http://kerneltrap.org/forum/linux/kernel">Linux kernel</a></td> </tr>
 <tr class="odd"><td><a href="http://kerneltrap.org/node/14302">Kernel drops ethernet packets every ten minutes...  Ideas?</a></td><td>1 day ago</td><td><a href="http://kerneltrap.org/forum/linux/kernel">Linux kernel</a></td> </tr>
 <tr class="even"><td><a href="http://kerneltrap.org/node/15778">pata_hpt37x driver and Lite-on DVDRW drive problem.</a></td><td>1 day ago</td><td><a href="http://kerneltrap.org/forum/linux/kernel">Linux kernel</a></td> </tr>
</tbody></table>
<div class="more-link"><a href="http://kerneltrap.org/forum" title="Read the latest forum postings.">Show all forums...</a></div></div>
</div>

<div id="block-tagadelic-7" class="block block-tagadelic">
    <div class="title">Recent Tags</div>
  
  <div class="content"><a href="http://kerneltrap.org/Linux" class="tagadelic level6">Linux</a> 
<a href="http://kerneltrap.org/2.6.25" class="tagadelic level1">2.6.25</a> 
<a href="http://kerneltrap.org/-rc" class="tagadelic level1">-rc</a> 
<a href="http://kerneltrap.org/-rc6" class="tagadelic level1">-rc6</a> 
<a href="http://kerneltrap.org/taxonomy/term/1210" class="tagadelic level1">lkml</a> 
<a href="http://kerneltrap.org/taxonomy/term/1211" class="tagadelic level1">Matti Aarnio</a> 
<a href="http://kerneltrap.org/quote" class="tagadelic level1">quote</a> 
<a href="http://kerneltrap.org/Linus_Torvalds" class="tagadelic level1">Linus Torvalds</a> 
<div class="more-link"><a href="http://kerneltrap.org/tags">more tags</a></div></div>
</div>

<div id="block-block-4" class="block block-block">
  
  <div class="content"><center><small>Colocation donated by:</small><br><a href="http://osuosl.org/"><img src="5262_files/thumbnail_small.gif"></a></center></div>
</div>

<div id="block-user-3" class="block block-user">
    <div class="title">Who's online</div>
  
  <div class="content">There are currently <em>9 users</em> and <em>1640 guests</em> online.<div class="item-list"><h3>Online users</h3><ul><li><a href="http://kerneltrap.org/user/2808" title="View user profile.">mcmanus</a></li><li><a href="http://kerneltrap.org/user/1" title="View user profile.">Jeremy</a></li><li><a href="http://kerneltrap.org/user/3754" title="View user profile.">memphis</a></li><li><a href="http://kerneltrap.org/user/7167" title="View user profile.">strcmp</a></li><li><a href="http://kerneltrap.org/user/1468" title="View user profile.">Hiryu</a></li><li><a href="http://kerneltrap.org/user/1187" title="View user profile.">krash</a></li><li><a href="http://kerneltrap.org/user/50" title="View user profile.">Mr_Z</a></li><li><a href="http://kerneltrap.org/user/16867" title="View user profile.">nextraztus</a></li><li><a href="http://kerneltrap.org/user/9198" title="View user profile.">andy</a></li></ul></div></div>
</div>

<div id="block-node-0" class="block block-node">
    <div class="title">Syndicate</div>
  
  <div class="content"><a href="http://kerneltrap.org/node/feed" class="feed-icon"><img src="5262_files/feed.png" alt="Syndicate content" title="Syndicate content" height="16" width="16"></a></div>
</div>

</div>
  
  <div style="clear: both;"></div>
</div>

<div class="footer">
  <a href="">Â© 2007 KernelTrap.</a> &nbsp;|&nbsp; Powered by <a href="http://www.drupal.org/">Drupal</a>. &nbsp;|&nbsp; <a href="">Legal statement.</a>
</div>

<div style="display: none;"><a href="http://kerneltrap.org/forumgroovy.php">speck-geostationary</a></div>

</body></html>