<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><head><!-- MHonArc v2.6.6 --><!--X-Subject: Re: PREEMPT_RT vs ADEOS: the numbers, part 1 --><!--X-From-R13: Oaqern Oepnatryv <naqernNfhfr.qr> --><!--X-Date: Sun, 12 Jun 2005 19:47:02 &#45;0500 (EST) --><!--X-Message-Id: 20050613004530.GH5796@g5.random --><!--X-Content-Type: text/plain --><!--X-Reference: 42AA6A6B.5040907@opersys.com --><!--X-Reference: 20050611191448.GA24152@elte.hu --><!--X-Reference: 42AB662B.4010104@opersys.com --><!--X-Reference: 20050612061108.GA4554@elte.hu --><!--X-Reference: 42AC8D00.4030809@opersys.com --><!--X-Reference: 20050612205902.GA31928@elte.hu --><!--X-Head-End-->















<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2"><title>Linux-Kernel Archive: Re: PREEMPT_RT vs ADEOS: the numbers, part 1</title>

<meta name="Author" content="Andrea Arcangeli &lt;andrea@suse.de&gt;">
<meta name="Subject" content="Re: PREEMPT_RT vs ADEOS: the numbers, part 1"></head><body bgcolor="#ffffff" text="#000000">

<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->


<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: PREEMPT_RT vs ADEOS: the numbers, part 1</h1>
<strong>From: </strong>Andrea Arcangeli
<br><strong>Date: </strong> Sun Jun 12 2005 - 19:47:02 EST
<p>
</p><ul>
<li><strong>Next message: </strong> <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/1172.html"> randy_dunlap: "Re: PREEMPT_RT vs ADEOS: the numbers, part 1"</a>

</li><li><strong>Previous message: </strong> <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/1170.html"> Kemal Hadimli: "poor performance with HIGHMEM?"</a>

</li><li><strong>In reply to: </strong> <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/1156.html"> Ingo Molnar: "Re: PREEMPT_RT vs ADEOS: the numbers, part 1"</a>

</li><li><strong>Next in thread: </strong> <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/1175.html"> Karim Yaghmour: "Re: PREEMPT_RT vs ADEOS: the numbers, part 1"</a>

</li><li><strong>Messages sorted by: </strong><a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/date.html#1171">[ date ]</a> <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/index.html#1171">[ thread ]</a> <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/subject.html#1171">[ subject ]</a> <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/author.html#1171">[ author ]</a>
</li></ul>

<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr noshade="noshade">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
On Sun, Jun 12, 2005 at 10:59:02PM +0200, Ingo Molnar wrote:<br>
&gt;<i> if you want to measure hw-interrupt delays then under PREEMPT_RT you'll </i><br>
&gt;<i> need to use an SA_NODELAY interrupt handler. (which is a PREEMPT_RT </i><br>
&gt;<i> specific flag) If you use normal request_irq() or some parport driver </i><br>
&gt;<i> then the driver function will run in an interrupt thread and what you </i><br>
&gt;<i> are measuring is not interrupt latency but rescheduling latency.</i><br>
<br>
Karim, just in case you're not very familiar with parport, this should<br>
do the trick:<br>
<br>
diff --git a/drivers/parport/parport_pc.c b/drivers/parport/parport_pc.c<br>
--- a/drivers/parport/parport_pc.c<br>
+++ b/drivers/parport/parport_pc.c<br>
@@ -2286,7 +2286,7 @@ struct parport *parport_pc_probe_port (u<br>
 	}<br>
 	if (p-&gt;irq != PARPORT_IRQ_NONE) {<br>
 		if (request_irq (p-&gt;irq, parport_pc_interrupt,<br>
-				 0, p-&gt;name, p)) {<br>
+				 SA_NODELAY, p-&gt;name, p)) {<br>
 			printk (KERN_WARNING "%s: irq %d in use, "<br>
 				"resorting to polled operation\n",<br>
 				p-&gt;name, p-&gt;irq);<br>
<br>
Unless I'm missing something, this mode is only valid if coding the RT<br>
code in the hardirq handler, which didn't seem the main benefit of<br>
preempt-RT to me, but it's still an interesting basic benchmark,<br>
especially now that local_irq_disable is "soft".<br>
<br>
But I'd be nice to also measure the performance of the non-RT part of<br>
the workload, just a suggestion if you have time.<br>
<br>
With above patch applied my crystal ball expects preempt-RT to perform<br>
much closer to adeos, but with the difference that the non-RT part of<br>
the system will still get the burden of the added complexity that adeos<br>
won't have.<br>
<br>
Thanks.<br>
-<br>
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in<br>
the body of a message to majordomo@xxxxxxxxxxxxxxx<br>
More majordomo info at  <a href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a><br>
Please read the FAQ at  <a href="http://www.tux.org/lkml/">http://www.tux.org/lkml/</a><br>
<br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr noshade="noshade">



<!--X-Follow-Ups-End-->
<!--X-References-->








<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li><strong>Next message: </strong> <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/1172.html"> randy_dunlap: "Re: PREEMPT_RT vs ADEOS: the numbers, part 1"</a>

</li><li><strong>Previous message: </strong> <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/1170.html"> Kemal Hadimli: "poor performance with HIGHMEM?"</a>

</li><li><strong>In reply to: </strong> <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/1156.html"> Ingo Molnar: "Re: PREEMPT_RT vs ADEOS: the numbers, part 1"</a>

</li><li><strong>Next in thread: </strong> <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/1175.html"> Karim Yaghmour: "Re: PREEMPT_RT vs ADEOS: the numbers, part 1"</a>

</li><li><strong>Messages sorted by: </strong><a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/date.html#1171">[ date ]</a> <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/index.html#1171">[ thread ]</a> <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/subject.html#1171">[ subject ]</a> <a href="http://www.ussg.iu.edu/hypermail/linux/kernel/0506.1/author.html#1171">[ author ]</a>
</li></ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->

</body></html>