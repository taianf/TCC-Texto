\section{Linux$^{\mathbf{Prt}}$ and Linux$^{\mathbf{Xen}}$
  assessment}
\label{cap:platEstud}

\subsection{Configuration}

The experiments were conducted on three Pentium 4 computers with $2.6 GHz$
processors and $512 MB$ RAM memory. Three operating system patches were analyzed:

\begin{description}
\item[$\bullet \;$ Linux$^{\mathbf{Std}}$:] Linux standard - \kernell version 2.6.23.9
  (\ing{low-latency} option);
\item[$\bullet \;$ Linux$^{\mathbf{Prt}}$:] Linux with \ing{patch}
  \preemptt (rt12) - \kernell version 2.6.23.9;
\item[$\bullet \;$ Linux$^{\mathbf{Xen}}$:] Linux with \ing{patch} Xenomai - version
  2.4-rc5 - \kernell version 2.6.19.7.
\end{description}

The stable Linux$^{\mathbf{Prt}}$ version, \kernell
2.6.23.9 released in December 2007, was chosen. As for Linux$^{\mathbf{Prt}}$, the \kernell version of 2.6.19.7 along with the Xenomai version 2.4-rc5 were used. Since Xenomai is based on Adeos (see Section
\ref{sec:xenomai}), temporal guarantees offered to applications
executing in the first domain only depend on the Xenomai version and its associated
patch Adeos and not on the Linux \kernell version. Thus, we decided not to consider a newer  

% As medidas das latências de interrupção e de ativação foram realizadas pela consulta
% do \ing{Time Stamp Counter} (TSC), permitindo uma precisão abaixo de $30 ns$ (88
% ciclos), verificada experimentalmente.  Utilizou-se uma freqüência de disparo dos
% eventos pela estação $E_D$ de 20Hz.  Para cada plataforma, dois experimentos de 10
% minutos foram realizados. O primeiro sem carga nenhuma do sistema e o segundo
% aplicando os estresses apresentados na Seção \ref{sec:carga}.

The interrupt and activation latency measurements were made by reading the Time
Stamp Counter (TSC), allowing a precision of less than $30 ns$ (88 cycles),
experimentally verified. In both experiments, a $20Hz$ frequency was used by station
$E_T$ to trigger events at station $E_M$. For each platform and configuration, two
experiments were conducted of 10 minutes each. The first was carried on without any
load of the system and the second was carried on applying the loads presented in
Section \ref{sec:carga}.

%  \col{Para a plataforma Linux$^{\mathbf{Xen}}$, apesar do experimento com
% estresses ter sido repetido por uma duração de 12 horas, os resultados confirmaram
% os resultados obtidos com duração de 10 minutos}.


% Para as duas plataformas RTAI e Xenomai, os diferentes testes de latências
% fornecidos foram utilizados, dando resultados menores que $10 \mu s$ no pior caso
% para a latência de interrupção, conforme os padrões da arquitetura Intel Pentium
% 4. Em ambas plataformas, desabilitou-se as interrupções de gerenciamento do
% sistema (\ing{SMI}), conforme as recomendações dos desenvolvedores \cite{RTAI,
%   Xenomai}. Isto cancelou uma latência periódica (a cada 32 segundos) de
% aproximadamente $2.5ms$ que aparecia nos testes.  No caso das plataforma Lx19
% Linux$^{\mathbf{Std}}$ e Linux$^{\mathbf{Prt}}$, estas interrupções foram também
% desabilitadas, porém, não foi constatado nenhuma alteração das medidas realizadas.
% as interrupções de gerenciamento do sistema não foram desabilitadas.  No entanto,
% pelo fato das interrupções \ing{SMI} ter um período de 32 segundos, este fato não
% alterou os resultados experimentais de forma significativa.  No entanto, não se
% observou nenhuma latência da ordem de $2.5ms$ nos experimentos relativos a estas
% duas plataformas. Provavelmente, porque a interrupção periódica de SMI aconteceu
% num intervalo de tempo sem medida.


% Observar que RT-Linux, RTAI e Xenomai adotam soluções tecnológicas parecidas,
% baseadas em \ing{nanokernel}. Portanto, o estudo comparativo foi realizado apenas
% com a plataforma Xenomai.

Experimental results are presented through Figures
in which the horizontal axis represents the instant of observation
ranging from 0 to 60 seconds and the vertical axis represents the latencies measures
in $\mu s$ (such values should be multiplied by $2.6 10^3$ to obtain the number of
TSC cycles). Although each experiment was run for ten minutes, Figures are presented
for a range of $60s$, as such interval is sufficient to observe the pattern of
behavior of each platform. During this one minute interval, the total number of
events is 1200, as the arrival frequency of Ethernet frame at the $eth_0$
network device of station $E_M$ is $20 Hz$.

Below each figure, the following values are given: Mean (Mean), Standard Deviation
(SD), minimum (Mn) and maximum (Mx). These numbers were obtained considering
the duration of ten minutes of each experiment. As much as possible, the same
vertical scale was used for all graphics. As a result, high values may have layed
outside the graphics. Such occurrences was represented by a triangle near the maximum
value of the vertical axis.

\subsection{First configuration experimental results}
\label{sec:resExp}

% Os resultados experimentais são apresentados nas Figuras \ref{fig:latIrq} e
% \ref{fig:latAtiv}, onde o eixo horizontal representa o instante de observação
% variando de 0 a 60 segundos e o eixo vertical representa as latências medidas em
% $\mu s$ (tais valores podem ser multiplicados por $2.6 10^3$ para obter o número de
% ciclos do TSC).  Apesar de cada experimento ter durado no mínimo uma hora,
% escolheu-se apresentar apenas resultados para um intervalo de $60s$, pois este
% intervalo é suficiente para observar o padrão de comportamento de cada
% plataforma. Neste intervalo, o total de eventos por experimentos é 1200, pois a
% freqüência de chegada de pacotes utilizada foi de $20 Hz$.

The experimental results for the first configuration (see Section \ref{sec:exp1})
are shown in Figure \ref{fig:latIrq} and\ref{fig:latAtiv}.
		
% Abaixo de cada Figura, os seguintes valores são indicados: Valor Médio (VM), desvio
% padrão (DP), valor mínimo (Min) e valor máximo (Max). Estes valores foram obtidos
% considerando a duração de uma hora de cada experimento. Na medida do possível,
% utilizou-se a mesma escala vertical para todos os gráficos.  Conseqüentemente,
% alguns valores altos podem ter ficado fora das Figuras. Tal ocorrência foi
% representada por um triângulo próximo do valor máximo do eixo vertical.


\subsubsection{Interrupt latencies}
\label{sec:latIrq}

\begin{figure*}%
  \centering
  \subfloat[\small{\textbf{Linux$^{\mathbf{Std}}$ - without load} \newline
  \vskip 1mm M:     8.9, SD:     0.3,  Mn:     8.7, Mx:    18.4 }]{%
    \label{fig:ker23Sem}%
    {\scalebox{0.58}{\input{fig/ker23Sem}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Std}}$ - with loads} \newline
  \vskip 1mm M:    10.4, SD:     1.9,  Mn:     8.8, Mx:    67.7 }]{%
    \label{fig:ker23Tot}%
    {\scalebox{0.58}{\input{fig/ker23Tot}}}}%

  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - without load} \newline
  \vskip 1mm M: 21.5, SD: 1.7, Mn: 20.3, Mx: 45.1 }]{%
    \label{fig:preSem}%
    {\scalebox{0.58}{\input{fig/preSem}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - with loads} \newline
  \vskip 1mm M: 58.5, SD: 26.4, Mn: 17.2, Mx: 245.9}]{%
    \label{fig:preTot}%
    {\scalebox{0.58}{\input{fig/preTot}}}}%

  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - without load, option
      \cod{IRQF\_NODELAY}} \newline
    \vskip 1mm M: 8.9, SD: 0.2, Mn: 8.8, Mx: 16.7}]{%
    \label{fig:preSemSchedND}%
    {\scalebox{0.58}{\input{fig/preSemND}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - with loads, option
      \cod{IRQF\_NODELAY}} \newline
    \vskip 1mm M: 10.6, SD: 1.6, Mn: 8.9, Mx: 35.8}]{%
    \label{fig:preTotSchedND}%
    {\scalebox{0.58}{\input{fig/preTotND}}}}

  \subfloat[\small{\textbf{Linux$^{\mathbf{Xen}}$ - without load} \newline
  \vskip 1mm M: 9.0, SD: 0.1, Mn: 8.8, Mx: 11.1}]{%
    \label{fig:xenSem}%
    {\scalebox{0.58}{\input{fig/xenSem}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Xen}}$ - with loads} \newline
  \vskip 1mm M: 10.2, SD: 0.1, Mn: 8.8, Mx: 20.8}]{%
    \label{fig:xenTot}%
    {\scalebox{0.58}{\input{fig/xenTot}}}}%

  \caption[Interrupt latencies]{Interrupt latencies with PP-IRQ triggered by the
    $eth_0$ interrupt handler with a $20 Hz$ frequency.}
  \label{fig:latIrq}%
\end{figure*}

% A Figura \ref{fig:latIrq} apresenta as latências de interrupção medidas, com e sem
% estresse do sistema.  Como pode ser observado, sem carga, o Linux$^{\mathbf{Std}}$ e
% o Linux$^{\mathbf{Xen}}$ tem comportamentos parecidos. Com carga, observa-se uma
% variação significativa do Linux$^{\mathbf{Std}}$, como esperado.

Figure \ref{fig:latIrq} shows the interrupt latencies measured, with and without
load of the system. As can be seen, without load, Linux$^{\mathbf{Std}}$ and
Linux$^{\mathbf{Xen}}$ has similar behaviour. With loads, there is a significant
variation of Linux$^{\mathbf{Std}}$, as expected.

% Com relação ao Linux$^{\mathbf{Prt}}$, dois resultados chamam atenção. Primeiro, o
% comportamento do sistema sem carga exibe latências da ordem de 20 $\mu s$. Isto é
% causado pela implementação dos \ing{threads} de interrupção vista na Seção
% \ref{sec:preemptRT}.  Segundo, contradizendo as expectativas, a aplicação do
% estresses teve um impacto significativo, provocando uma alta variabilidade das
% latências. De fato, entre o instante no qual o tratador $T_{PP}$ requer a
% interrupção do processador e o instante no qual este \ing{thread} acorda
% efetivamente, uma ou várias interrupções podem ocorrer.  Neste caso, a execução dos
% tratadores associados pode provocar o atraso da execução de $T_{PP}$.

With respect to Linux$^{\mathbf{Prt}}$, two results draw attention. First, in
absence of load, the system displays latencies of around $20 \mu s$. This is due to
the threaded implementation of interruption seen in Section \ref{sec:preemptRT}.
Second, contradicting the expectations, the application of load had a significant
impact, causing a high variability of latency. In fact, between the instant in which
the $T_{PP}$ handler requires the interruption of the processor and the instant in
which the IRQ thread actually wakes up, one or more interruptions may occur. In such
a case, the execution of the associated handlers may delay the execution of
$T_{PP}$.
 
% Para cancelar esta variabilidade indesejável, é possível usar o
% Linux$^{\mathbf{Prt}}$ sem utilizar a implementação de \ing{threads} de
% interrupção. Para tanto, usa-se a opção \cod{IRQF\_NODELAY} na requisição inicial da
% linha de interrupção. Utilizando esta opção na definição da linha de interrupção da
% porta paralela, o comportamento do Linux$^{\mathbf{Prt}}$ passa a ser semelhante ao
% Linux$^{\mathbf{Std}}$.

To cancel this undesirable variability, one can use Linux$^{\mathbf{Prt}}$ without
using the implementation of threads of interruption. For this, one use the option
\cod{IRQF\_NODELAY} at initialization time of the IRQ line. As can be observed,
using this option in requesting the PP-IRQ line, the behavior of
Linux$^{\mathbf{Prt}}$ turns to be similar to Linux$^{\mathbf{Std}}$.

\subsubsection{Activation latencies}

% A Figura \ref{fig:latAtiv} apresenta os resultados para as latências de ativação sem
% estresse e com estresse do processador.  Como pode ser observado, o comportamento de
% Linux$^{\mathbf{Std}}$ é inadequado para atender os requisitos de tempo
% real. Linux$^{\mathbf{Prt}}$ e Linux$^{\mathbf{Xen}}$, por outro lado, apresentam
% valores de latências dentro dos padrões esperados.  Vale a pena notar o
% comportamento destes sistemas com carga.  Apesar do valor médio encontrado para
% Linux$^{\mathbf{Xen}}$ ($8,7 \mu s$) ser superior ao do Linux$^{\mathbf{Prt}}$ ($3,8
% \mu s$), o desvio padrão é significativamente menor em favor de
% Linux$^{\mathbf{Xen}}$, característica desejável nos sistemas de tempo real
% críticos. De fato, para tais sistemas, deseja-se que o pior caso seja próximo do
% caso médio.

Figure \ref{fig:latAtiv} shows the results for the activation latencies without and
with load of the processor. As can be seen, the behavior of Linux$^{\mathbf{Std}}$
is inadequate to meet the real-time requirements. On the other hand,
Linux$^{\mathbf{Prt}}$ and Linux$^{\mathbf{Xen}}$ have values of latencies within
the expected standard. It is worth noting the behavior of these systems with
load. Although the average value found for Linux$^{\mathbf{Xen}}$ ($8,7 \mu s$) is
superior to the Linux$^{\mathbf{Prt}}$ ($3,8 \mu s$), the standard deviation is
significantly lower in favor of Linux$^{\mathbf{Xen}}$, desirable feature in
real-time critical systems. In fact, for such systems, hopes that the worst case is
close to the average case.
	
\begin{figure*}%
  \centering
  \subfloat[\small{\textbf{Linux$^{\mathbf{Std}}$ - without load} \newline
  \vskip 1mm M:     4.6, SD:     0.4,  Mn:     4.4, Mx:    16.2}]{%
    \label{fig:ker23SemSched}%
    {\scalebox{0.58}{\input{fig/ker23SemSched}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Std}}$ - with loads}\newline
  \vskip 1mm M:    37.3, SD:    48.2,  Mn:     4.6, Mx:   617.5}]{%
    \label{fig:ker23TotSched}%
    {\scalebox{0.58}{\input{fig/ker23TotSched}}}}

  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - without load} \newline
  \vskip 1mm M: 2.1, SD: 0.2, Mn: 1.2, Mx: 9.4}]{%
    \label{fig:preSemSched}%
    {\scalebox{0.58}{\input{fig/preSemSched}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - with loads} \newline
  \vskip 1mm M: 3.8, SD: 2.8, Mn: 1.1, Mx: 27.4}]{%
    \label{fig:preTotSched}%
    {\scalebox{0.58}{\input{fig/preTotSched}}}}

  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - without load, option
      \cod{IRQF\_NODELAY}} \newline
  \vskip 1mm M:     5.3, SD:     0.3,  Mn:     5.0, Mx:    13.1}]{%
    \label{fig:preSemSchedND}%
    {\scalebox{0.58}{\input{fig/preSemSchedND}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - with loads, option
      \cod{IRQF\_NODELAY}} \newline
  \vskip 1mm M:     8.0, SD:     2.0,  Mn:     5.2, Mx:    31.0}]{%
    \label{fig:preTotSchedND}%
    {\scalebox{0.58}{\input{fig/preTotSchedND}}}}

  \subfloat[\small{\textbf{Linux$^{\mathbf{Xen}}$ - without load} \newline
  \vskip 1mm M: 2.1, SD: 0.5, Mn: 1.8, Mx: 8.4}]{%
    \label{fig:xenSemSched}%
    {\scalebox{0.58}{\input{fig/xenSemSched}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Xen}}$ - with loads} \newline
  \vskip 1mm M: 8.7, SD: 0.3, Mn: 1.8, Mx: 18.7}]{%
    \label{fig:xenTotSched}%
    {\scalebox{0.58}{\input{fig/xenTotSched}}}}

  \caption[]{Activation latencies with PP-IRQ triggered by the
    $eth_0$ interrupt handler with a $20 Hz$ frequency.}
  \label{fig:latAtiv}%
\end{figure*}

% É interessante ainda comparar o comportamento de Linux$^{\mathbf{Prt}}$ sem utilizar
% o contexto de \ing{threads} de interrupção, isto é, com a opção \cod{IRQF\_NODELAY},
% comentada anteriormente. Como pode ser observado na Figura \ref{fig:latAtivND},
% apesar das latências de ativação sem estresse apresentar bons resultados em
% comparação ao Linux$^{\mathbf{Prt}}$, seus valores com estresse indicam um
% comportamento menos previsível que o Linux$^{\mathbf{Xen}}$.

It is also interesting to compare the behavior of Linux$^{\mathbf{Prt}}$ without
using the implementation of interuption thread , that is, with the option
\cod{IRQF\_NODELAY}, commented earlier. As can be seen in Figure\ref{fig:latAtiv},
despite the latencies of activation without load apresenting good results in comparison to
Linux$^{\mathbf{Prt}}$, its values with load indicate a slightly less predictable
behavior than Linux$^{\mathbf{Xen}}$.

% \begin{figure*}%
%   \centering
%   \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - without load} \newline
%   \vskip 1mm M:     5.3, SD:     0.3,  Mn:     5.0, Mx:    13.1}]{%
%     \label{fig:preSemSchedND}%
%     {\scalebox{0.58}{\input{fig/preSemSchedND}}}} \hspace{44pt}%
%   \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - with loads} \newline
%   \vskip 1mm M:     8.0, SD:     2.0,  Mn:     5.2, Mx:    31.0}]{%
%     \label{fig:preTotSchedND}%
%     {\scalebox{0.58}{\input{fig/preTotSchedND}}}}

%   \caption[]{Activation latency of Linux$^{\mathbf{Prt}}$
%     without interruption threading  (option \cod{IRQF\_NODELAY}).}
%   \label{fig:latAtivND}%
% \end{figure*}

% \begin{figure}%
%   \centering
%   \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - without load} \newline
%   \vskip 1mm M:     8.9, SD:     0.2,  Mn:     8.8, Mx:    16.7}]{%
%     \label{fig:preSemSchedND}%
%     {\scalebox{0.58}{\input{fig/preSemND}}}}
%   \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - with loads} \newline
%   \vskip 1mm M:     10.6, SD:     1.6,  Mn:     8.9, Mx:    35.8}]{%
%     \label{fig:preTotSchedND}%
%     {\scalebox{0.58}{\input{fig/preTotND}}}}

%   \caption[]{Latência de interrupção do Linux$^{\mathbf{Prt}}$
%     desabilitando o \ing{thread} associado as interrupções da
%     PP (opção \cod{IRQF\_NODELAY}).}
%   \label{fig:latAtivND}%
% \end{figure}


\subsection{Second configuration experimental results}
\label{sec:resExp}

The experimental results for the second experimental configuration (see Section
\ref{sec:exp2}) are shown in Figure \ref{fig:latIrq2} and \ref{fig:latAtiv2}.

\subsubsection{Interrupt latencies}
\label{sec:latIrq}

\begin{figure*}%
  \centering
  \subfloat[\small{\textbf{Linux$^{\mathbf{Std}}$ - without load} \newline
  \vskip 1mm M:    18.0, SD:     0.3,  Mn:     9.6, Mx:    27.3 }]{%
    \label{fig:ker23Sem}%
    {\scalebox{0.58}{\input{fig2/ker23Sem}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Std}}$ - with loads} \newline
  \vskip 1mm M:    21.8, SD:     3.2,  Mn:     9.8, Mx:    80.6 }]{%
    \label{fig:ker23Tot}%
    {\scalebox{0.58}{\input{fig2/ker23Tot}}}}%

  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - without load} \newline
  \vskip 1mm M:    19.4, SD:     0.5,  Mn:     9.8, Mx:    42.2 }]{%
    \label{fig:preSem}%
    {\scalebox{0.58}{\input{fig2/preSem}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - with loads} \newline
  \vskip 1mm M:    41.9, SD:    18.9,  Mn:     9.7, Mx:   324.4 }]{%
    \label{fig:preTot}%
    {\scalebox{0.58}{\input{fig2/preTot}}}}%

  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - without load, option
      \cod{IRQF\_NODELAY}} \newline
    \vskip 1mm M:    18.1, SD:     0.3,  Mn:     9.1, Mx:    25.5 }]{%
    \label{fig:preSemSchedND}%
    {\scalebox{0.58}{\input{fig2/preSemND}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - with loads, option
      \cod{IRQF\_NODELAY}} \newline
    \vskip 1mm M:    21.2, SD:     2.4,  Mn:     9.1, Mx:    50.5  }]{%
    \label{fig:preTotSchedND}%
    {\scalebox{0.58}{\input{fig2/preTotND}}}}

  \subfloat[\small{\textbf{Linux$^{\mathbf{Xen}}$ - without load} \newline
  \vskip 1mm M:    18.2, SD:     0.3,  Mn:     9.1, Mx:    23.1 }]{%
    \label{fig:xenSem}%
    {\scalebox{0.58}{\input{fig2/xenSem}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Xen}}$ - with loads} \newline
  \vskip 1mm M:    20.7, SD:     1.5,  Mn:     9.1, Mx:    30.0 }]{%
    \label{fig:xenTot}%
    {\scalebox{0.58}{\input{fig2/xenTot}}}}%

  \caption[Interrupt latencies]{Interrupt latencies with PP-IRQ triggered on $E_M$
    by $E_T$ at a $20 Hz$ frequency.}
  \label{fig:latIrq2}%
\end{figure*}

% A Figura \ref{fig:latIrq} apresenta as latências de interrupção medidas, com e sem
% estresse do sistema.  Como pode ser observado, sem carga, o Linux$^{\mathbf{Std}}$ e
% o Linux$^{\mathbf{Xen}}$ tem comportamentos parecidos. Com carga, observa-se uma
% variação significativa do Linux$^{\mathbf{Std}}$, como esperado.

Figure \ref{fig:latIrq2} shows the interrupt latencies measured, with and without
load of the system.  As expected, an extra latency of $9$ to $10 \mu s$ is observed
for the interrupt latencies measurements of all platforms. As explained in Section
\ref{sec:exp2}, this extra latency corresponds to the interrupt latency of $E_T$
which was denoted $\delta$ in Figure \ref{fig:dispExp2}.

The only other noticeable difference is related to Linux $^{\mathbf{Prt}}$ whose
interrupt latencies values are somehow smaller in the second experiments. However,
this is due to the thread implementation, which reacts faster to an hardware
interrupt request than to a software interrupt request. As in the first experiment,
using the option \cod{IRQF\_NODELAY} to disable the parallel port IRQ threading, the
behavior of Linux$^{\mathbf{Prt}}$ turns to be similar to Linux$^{\mathbf{Std}}$.

As a first conclusion, we emphasize that results obtained with the second
configuration are similar to those obtained with the first experimental
configuration, thus motivating the use of the first experiment configuration for
future comparison works.

\subsubsection{Activation latencies}

\begin{figure*}%
  \centering
  \subfloat[\small{\textbf{Linux$^{\mathbf{Std}}$ - without load} \newline
  \vskip 1mm M:     5.7, SD:     0.6,  Mn:     5.0, Mx:    15.6 }]{%
    \label{fig:ker23SemSched}%
    {\scalebox{0.58}{\input{fig2/ker23SemSched}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Std}}$ - with loads}\newline
  \vskip 1mm M:    23.3, SD:    28.5,  Mn:     5.0, Mx:   623.3 }]{%
    \label{fig:ker23TotSched}%
    {\scalebox{0.58}{\input{fig2/ker23TotSched}}}}

  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - without load} \newline
  \vskip 1mm M:     6.1, SD:     0.6,  Mn:     5.0, Mx:    17.3 }]{%
    \label{fig:preSemSched}%
    {\scalebox{0.58}{\input{fig2/preSemSched}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - with loads} \newline
  \vskip 1mm M:    10.1, SD:     3.7,  Mn:     5.0, Mx:    70.5 }]{%
    \label{fig:preTotSched}%
    {\scalebox{0.58}{\input{fig2/preTotSched}}}}

  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - without load, option
      \cod{IRQF\_NODELAY}} \newline
  \vskip 1mm M:     6.8, SD:     0.4,  Mn:     5.1, Mx:    15.4 }]{%
    \label{fig:preSemSchedND}%
    {\scalebox{0.58}{\input{fig2/preSemSchedND}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Prt}}$ - with loads, option
      \cod{IRQF\_NODELAY}} \newline
  \vskip 1mm M:    15.6, SD:     6.6,  Mn:     5.0, Mx:   107.2}]{%
    \label{fig:preTotSchedND}%
    {\scalebox{0.58}{\input{fig2/preTotSchedND}}}}

  \subfloat[\small{\textbf{Linux$^{\mathbf{Xen}}$ - without load} \newline
  \vskip 1mm M:     6.5, SD:     0.5,  Mn:     5.0, Mx:    13.2 }]{%
    \label{fig:xenSemSched}%
    {\scalebox{0.58}{\input{fig2/xenSemSched}}}} \hspace{44pt}%
  \subfloat[\small{\textbf{Linux$^{\mathbf{Xen}}$ - with loads} \newline
  \vskip 1mm M:    11.1, SD:     3.0,  Mn:     5.0, Mx:    25.7 }]{%
    \label{fig:xenTotSched}%
    {\scalebox{0.58}{\input{fig2/xenTotSched}}}}

  \caption[Activation latencies]{Activation latencies with PP-IRQ triggered on $E_M$
    by $E_T$ at a $20 Hz$ frequency.}
  \label{fig:latAtiv2}%
\end{figure*}


Figure \ref{fig:latAtiv2} shows the activation latencies measured, with and without
load of the system. 

Somehow surprisingly, the $\delta$ extra latency observed in the interrupt latencies
measurements is much smaller ($\delta \approx 2.5 \mu s$) than the same latency observed
after the first PP-IRQ issued by $E_M$. This can be explained as
follow.  When station $E_M$ triggers the activation PP-IRQ, station $E_T$ is just
returning from the interrupt context of the interrupt PP-IRQ previously triggered by
$E_M$. As a consequence, the $E_M$ interrupt latency is significantly reduced.  It
is worth recalling that station $E_T$ executes the Xenomai platform with minimal
load, thus between the return of the first and the second interrupt triggered by
$E_M$, no other interrupt can happen. However, the standard deviation is significantly
increased, as the response time of the interrupt device (APIC) is source of temporal
variation.

Except for this increase of the latencies by the $\delta$ interrupt latency at
station $E_T$, and its related standard deviation, results obtained with the second
experimental configuration are similar to those obtained with the first experimental
configuration.


\section{Related work}
\label{sec:trabRel}

% Alguns resultados experimentais comparando Linux$^{\mathbf{Prt}}$ com
% Linux$^{\mathbf{Std}}$ são apresentados por \cite{Rostedt07}. Duas métricas são
% usadas, latências de interrupção e de escalonamento, relacionadas ao escalonamento
% de uma tarefa periódica.  No entanto, os experimentos foram realizados sem
% sobrecarga do processador e a metodologia usada não foi precisamente
% descrita. \cite{Siro07} realizam um estudo comparativo do Linux$^{\mathbf{Prt}}$, de
% RT-Linux \cite{rtLinux} e de Linux$^{\mathbf{RTAI}}$ \cite{RTAI} no qual eles
% utilizam conjuntamente o \ing{benchmark} LMbench \cite{McVoy96} e medidas de desvios
% na execução de uma tarefa periódica. Nestes experimentos, os autores aplicaram uma
% sobrecarga ``média'' do processador, sem considerar carga de interrupção. Num outro
% trabalho, divulgado apenas na Internet \cite{Benoit05}, os desenvolvedores do
% projeto Adeos apresentam resultados comparativos relativos ao Linux com os
% \ing{patches} \preemptt e Adeos. Esta avaliação, bastante abrangente, utiliza o
% \ing{benchmark} LMbench \cite{McVoy96} para caracterizar o desempenho das duas
% plataformas e apresenta resultados de medidas de latências de interrupção realizadas
% com a porta paralela.

Some experimental results comparing Linux$^{\mathbf{Prt}}$ with
Linux$^{\mathbf{Std}}$ are presented in \cite{Rostedt07}. Two metrics are used,
interrupt and scheduling latencies, related to the schedule of a periodic
task. However, the experiments were conducted without loading the processor and the
methodology used was not precisely described. \cite{Siro07} realizes a comparative
study of Linux$^{\mathbf{Prt}}$, RT-Linux \cite{rtLinux} and Linux$^{\mathbf{RTAI}}$
\cite{RTAI} in which they use both LMbench benchmark \cite{McVoy96} and measures of
deviations in the scheduling of a periodic task. In these experiments, the authors
applied an ``average'' load''of the processor, without considering interrupt
load. In another work, only published on the Internet \cite{Benoit05}, the developers of
the project Adeos present comparative results for Linux with the patches
\preemptt and Adeos. This assessment, rather comprehensive, uses LMbench 
benchmark LMbench \cite{McVoy96} to characterize the performance of the two platforms and
presents results of measures taken to interrupt latencies with the parallel port.

% O presente trabalho apresenta resultados de latência de interrupção que confirma os
% resultados obtidos em \cite{Benoit05} para a plataforma Linux$^{\mathbf{Xen}}$. Já
% os resultados encontrados aqui para Linux$^{\mathbf{Prt}}$, sem a opção
% \cod{IRQF\_NODELAY}, diferiram dos apresentados por \cite{Benoit05}, pois uma
% degradação das garantias temporais por esta plataforma foi observada, tal como visto
% na Seção \ref{sec:latIrq}. Em relação às latências de ativação, não temos
% conhecimento de nenhum outro trabalho comparativo. Experimentos idênticos aos
% relatados aqui foram conduzidos para a plataforma Linux$^{\mathbf{RTAI}}$
% \cite{Regnier08b} e os resultados encontrados são semelhantes aos apresentados para
% Linux$^{\mathbf{Xen}}$, dado que ambas plataformas utilizam o mesmo \nanokernel.

This paper presents results of latency of interruption that confirms the results
obtained in \cite{Benoit05} for the Linux platform
Linux$^{\mathbf{Xen}}$. Nevertheless, the results found here for
Linux$^{\mathbf{Prt}}$, without the option \cod{IRQF\_NODELAY}, differed from those
submitted by \cite{Benoit05}, as a degradation of time guarantees by the platform
was observed, as seen in Section \ref{sec:latIrq}. As for activation latencies, we
are not aware of any other comparative work. Experiments similar to those reported
here were conducted for the Linux$^{\mathbf{RTAI}}$ platform \cite{Regnier08b} and
the results are similar to those presented for Linux$^{\mathbf{Xen}}$, since both
platforms use the same Adeos \nanokernel.

\section{Conclusion}
\label{sec:conc}

% Neste trabalho, a avaliação de duas soluções de SOTR baseadas em Linux foi
% realizada. A metodologia experimental permitiu medir as latências de interrupção e
% de ativação, em situações de carga variável, tanto do processador quanto de eventos
% externos tratados por interrupção.  Enquanto o Linux padrão apresentou latências no
% pior caso acima de $100 \mu s$, as plataformas Linux$^{\mathbf{Prt}}$ e
% Linux$^{\mathbf{Xen}}$ conseguiram prover garantias temporais com uma precisão
% abaixo de $20 \mu s$. No entanto, para se conseguir este comportamento em relação ao
% Linux$^{\mathbf{Prt}}$, foi necessário desabilitar \ing{threads} de interrupção,
% tornando o sistema menos flexível. Com tais \ing{threads}, o comportamento de
% Linux$^{\mathbf{Prt}}$ sofre considerável degradação da sua previsibilidade
% temporal.  A plataforma Linux$^{\mathbf{Xen}}$ se mostrou mais adequada, pois tanto
% oferece um ambiente de programação em modo usuário, quanto consegue previsibilidade
% temporal característica de sistema de tempo real.

In this work, the evaluation of two RTOS solutions based on Linux was held. The
methodology has allowed experimental measurements of interrupt and activation
latencies, in situations of variable load, both of the processor and of external
events processed by interruption.  Two experimental configurations were used, the
first based on local measurements was compared with a more regular configuration
based on external measurements through the parallel port.  As both configuration
gives similar results, it appears that the first methodology is founded and can be
efficiently used for the purpose of real-time platforms comparisons.

While the standard Linux presented latencies in the worst case over $100 \mu s$, the
platforms Linux$^{\mathbf{Prt}}$ and Linux$^{\mathbf{Xen}}$ managed to provide
temporal guarantees with a precision below $20 \mu s$. However, in ordrer to achieve
this behaviour with Linux$^{\mathbf{Prt}}$, it was necessary to disable the
interruption threading for the parallel port IRQ line, making the system less
flexible. With such thread, the behavior of Linux$^{\mathbf{Prt}}$ suffers
considerable deterioration of its temporal predictability. The Linux platform
Linux$^{\mathbf{Xen}}$ was found more appropriate since offers a user-mode
programming environment as well as temporal predictability characteristic of
real-time system.

% \small
\bibliographystyle{abbrv}
\bibliography{bib}

\end{document}
